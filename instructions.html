<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Instructions</title>
    <link rel="stylesheet" href="assets/css/terms.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <input type="hidden" id="hdfBaseUrl" value="/">
    <input type="hidden" id="hdfObserverID" name="ObserverID" value="">
    <div id="all">
        <!-- Header -->
        <header class="main-header">
            <div class="navbar-affixed-top affix-top">
                <div class="navbar navbar-default yamm" role="navigation" id="navbar">
                    <div class="container">
                        <div class="navbar-header">
                            <a class="navbar-brand home" target="_blank">
                                <img src="assets/logo/crispr-logo-for-dark-bg.png" alt="Crispr Learning" class="img-responsive">
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div id="content">

            <div class="info-banner">
                <i class="fas fa-exclamation-circle"></i> To ensure a realistic exam environment, we run certain checks while you attempt the test. Please avoid switching tabs, minimizing the window, or changing network connectivity during the exam. Once started, the exam can only be taken on the same system it was initiated on. You are free to take a break if needed, but the exam timer will continue running.
            </div>

            <div class="container">
                <section>
                    <div class="row">
                        <div class="col-md-12 exam-confirm">
                            <div class="panel panel-default">
                                <div class="panel-body">
                                    <!-- English Instructions -->
                                    <div class="col-md-12 instruction-section" id="1" style="display: block;">
                                        <h4 class="text-center"><i class="fas fa-info-circle"></i> Please read the instructions carefully</h4>
                                        <h4><strong><u>General Instructions:</u></strong></h4>
                                        <ol>
                                            <li>Total duration of <span id="examName1"></span> is <span id="examDuration"></span> min.</li>
                                            <li>The clock will be set at the server. The countdown timer in the top right corner of the screen will display the remaining time available for you to complete the examination.</li>
                                            <li>
                                                The Questions Palette displayed on the right side of the screen will show the status of each question using one of the following symbols:
                                                <ol>
                                                    <li><img src="/img/QuizIcons/Logo1.png" alt="Not Visited"> You have not visited the question yet.</li>
                                                    <li><img src="/img/QuizIcons/Logo2.png" alt="Not Answered"> You have not answered the question.</li>
                                                    <li><img src="/img/QuizIcons/Logo3.png" alt="Answered"> You have answered the question.</li>
                                                    <li><img src="/img/QuizIcons/Logo4.png" alt="Marked for Review"> You have NOT answered the question, but have marked it for review.</li>
                                                    <li><img src="/img/QuizIcons/Logo5.png" alt="Answered and Marked for Review"> The question(s) "Answered and Marked for Review" will be considered for evaluation.</li>
                                                </ol>
                                            </li>
                                            <li>Use <img src="/img/QuizIcons/down.png" alt="Down"> to navigate to the bottom and <img src="/img/QuizIcons/up.png" alt="Up"> to navigate to the top of the question area without scrolling.</li>
                                        </ol>

                                        <h4><strong><u>Navigating to a Question:</u></strong></h4>
                                        <ol>
                                            <li>
                                                To answer a question, do the following:
                                                <ol>
                                                    <li>Click on the question number in the Question Palette at the right of your screen to go to that numbered question directly. Note that using this option does NOT save your answer to the current question.</li>
                                                    <li>Click on Save & Next to save your answer for the current question and then go to the next question.</li>
                                                    <li>Click on Mark for Review & Next to save your answer for the current question, mark it for review, and then go to the next question.</li>
                                                </ol>
                                            </li>
                                        </ol>

                                        <h4><strong><u>Answering a Question:</u></strong></h4>
                                        <ol>
                                            <li>
                                                Procedure for answering a multiple choice type question:
                                                <ol>
                                                    <li>To select you answer, click on the button of one of the options.</li>
                                                    <li>To deselect your chosen answer, click on the button of the chosen option again or click on the Clear Response button</li>
                                                    <li>To change your chosen answer, click on the button of another option</li>
                                                    <li>To save your answer, you MUST click on the Save & Next button.</li>
                                                    <li>To mark the question for review, click on the Mark for Review & Next button.</li>
                                                </ol>
                                            </li>
                                            <li>
                                                To change your answer to a question that has already been answered, first select that question for answering and then follow the procedure for answering that type of question.
                                            </li>
                                        </ol>

                                        <h4><strong><u>Navigating through sections:</u></strong></h4>
                                        <ol>
                                            <li>
                                                Sections in this question paper are displayed on the top bar of the screen. Questions in a section can be viewed by click on the section name. The section you are currently viewing is highlighted.
                                            </li>
                                            <li>After click the Save & Next button on the last question for a section, you will automatically be taken to the first question of the next section.
                                            </li>
                                            <li>You can shuffle between sections and questions anything during the examination as per your convenience only during the time stipulated.
                                            </li>
                                            <li>Candidate can view the corresponding section summery as part of the legend that appears in every section above the question palette.
                                            </li>
                                        </ol>

                                        <hr>
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="1_ch"> 
                                            <span>This mock test is designed to provide candidates with a real exam-like experience. It is not affiliated with or endorsed by the official testing authorities. Use this platform solely to familiarize yourself with the exam environment. I have read and understood the instructions. I agree to abide by the rules.</span>
                                        </label>
                                        <hr>
                                        <div class="text-center">
                                            <button onclick="check_instruction('1')" class="btn btn-proceed"><i class="fas fa-arrow-right"></i> Proceed</button>
                                        </div>
                                    </div>

                                    <!-- Hindi Instructions -->
                                    <div class="col-md-12 instruction-section" id="2" style="display: none;">
                                        <!-- Hindi content here (same structure as English) -->
                                    </div>

                                    <!-- Gujarati Instructions -->
                                    <div class="col-md-12 instruction-section" id="3" style="display: none;">
                                        <!-- Gujarati content here (same structure as English) -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <!-- Footer -->
        <div id="copyright">
            <div class="container">
                <div class="col-md-12">
                    <p class="text-center">&copy; All Rights Reserved - Crispr Learning</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.6/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        
        function getUserTokenForInstructions() {
            const urlParams = new URLSearchParams(window.location.search);
            return "Bearer " + decodeURIComponent(urlParams.get('token'));
        }

        function renderCustomContent() {
            const urlParams = new URLSearchParams(window.location.search);
            const metadataPassed = urlParams.get('metadata');
            const customData = JSON.parse(decodeURIComponent(metadataPassed));

            document.getElementById("examName1").innerHTML = customData["title"];
        }

        renderCustomContent();

        function proceedToExam() {

            const urlParams = new URLSearchParams(window.location.search);
            const examKey = urlParams.get('exam');
            const seriesKey = urlParams.get('series');
            const userToken = getUserTokenForInstructions();


            let browserFingerprint = {
                screenWidth: screen.width,
                screenHeight: screen.height,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                language: navigator.language,
                platform: navigator.platform,
                cpuCores: navigator.hardwareConcurrency,
                deviceMemory: navigator.deviceMemory || "unknown",
            };

            var reqData = {
                "exam": examKey,
                "series": seriesKey,
                "fingerprint": browserFingerprint 
            }

            var startExamRequest = {
              "url": "https://crisprtech.app/crispr-apis/user/start-exam.php?termsAccepted=1",
              "method": "POST",
              "timeout": 0,
              "data" : JSON.stringify(reqData),
              "headers": {
                "Content-Type": "application/json",
                "Authorization": getUserTokenForInstructions()
              },
            };

            $.ajax(startExamRequest).done(function (startExamResponse) {
                if(startExamResponse.status == "success") {
                    var redirectUrl = startExamResponse.data.url;
                    window.open(redirectUrl, "_blank");
                } else {
                    alert(startExamResponse.message || startExamResponse.error);
                }
            });
        }

        function check_instruction(sectionId) {
            const checkbox = document.getElementById(`${sectionId}_ch`);
            if (!checkbox.checked) {
                alert("Please confirm that you have read and understood the instructions.");
                return;
            }

            proceedToExam();
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('1').style.display = 'block';
        });


    </script>
</body>
</html>